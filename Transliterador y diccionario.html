<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Transliterador y Diccionario Shalkio</title>

<style>
  body {
    background:#0e0e0e;
    color:#eee;
    font-family: monospace;
    padding:20px;
    padding-top: 64px;
    animation: fadeInPage 0.4s ease-out;
  }
  
  @keyframes fadeInPage {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  textarea {
    width:100%;
    height:220px;
    background:#000;
    color:#0f0;
    border:1px solid #444;
    padding:10px;
    font-size:16px;
    box-sizing: border-box;
    outline: none;
  }

  #navbar {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 44px;
    background: #111;
    border-bottom: 1px solid #333;
    display: flex;
    align-items: center;
    padding: 0 12px;
    z-index: 1000;
  }

  #navbar a {
    color: #0f0;
    text-decoration: none;
    margin-right: 16px;
    font-size: 14px;
  }

  #navbar a:hover { text-decoration: underline; }

  #list {
    margin-top: 15px;
    padding: 0;
    list-style: none;
  }

  .entry-card {
    background: #151515;
    border: 1px solid #333;
    padding: 15px;
    margin-bottom: 8px;
    border-left: 4px solid #0f0;
    display: flex;
    flex-direction: column;
  }

  .shalkio-word { font-size: 1.4em; color: #0f0; font-weight: bold; }
  .meaning-text { color: #fff; margin-left: 12px; font-size: 1.1em; }
  .notes-text { color: #888; font-size: 0.9em; margin-top: 5px; font-style: italic; }

  #letters { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 20px; }
  #letters button {
    background: #222;
    color: #0f0;
    border: 1px solid #444;
    padding: 8px 12px;
    cursor: pointer;
    font-family: monospace;
  }

  #letters button:hover { background: #0f0; color: #000; }
  .active-btn { background: #0f0 !important; color: #000 !important; font-weight: bold; }

  h2 { color: #0f0; text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid #333; padding-bottom: 8px; }
  
  .import-box {
    background: #1a1a1a;
    padding: 15px;
    border: 1px solid #0f0;
    margin: 10px 0;
  }
</style>
</head>

<body>

<div id="navbar">
    <a href="Index.html">üí¨ Inicio</a>
    <a href="Transliterador y diccionario.html">üìò Diccionario</a>
    <a href="Gramatica.html">üìê Gram√°tica</a>
    <a href="lore.html">üìú Lore</a>
</div>

<h2>üßæ Transliterador</h2>
<p>Usa <b>&lt;</b> para acento (respeta may√∫sculas)</p>
<textarea id="txt" placeholder="Escribe aqu√≠..."></textarea>

<hr>

<h2>üìò Diccionario Shalkio</h2>

<div class="import-box">
  <label>üìÇ Cargar Diccionario (.json): </label>
  <input type="file" id="importFile" accept=".json">
</div>

<div id="letters"></div>
<h3 id="currentLetter">Letra: –ê</h3>

<input id="search" placeholder="üîç Buscar palabra o significado (Buscador Inteligente)..." style="width:100%; padding:12px; background:#000; color:#0f0; border:1px solid #444; font-family: monospace; outline: none;">
<ul id="list"></ul>

<script>
/* ================= VARIABLES Y CONFIGURACI√ìN ================= */
let dictionary = {};
const alphabet = ["–ê","–ë","–í","–ì","“ê","–ï","–Å","–°","–î","–ö","–•'","–•","–§","–õ","–ú","–ù","–û","–ü","–†","–°'","–¢","–£","–ó","–ñ","–ò","–ô","–´","–Ø","–Æ","–ß","–®","–©","–≠","√á"];
let current = "–ê";

const trans = {
  "Ch":"–ß","–óh":"–ñ","–öh":"–•'","√ách":"–©","G'":"“ê","Ye":"–ï","Yo":"–Å","√áh":"–®","Ya":"–Ø","Yu":"–Æ","Y'":"–´",
  "A":"–ê","B":"–ë","V":"–í","G":"–ì","D":"–î","K":"–ö","T":"–¢","J":"–•","F":"–§","L":"–õ","M":"–ú","N":"–ù","O":"–û","P":"–ü",
  "R":"–†","S":"√á","U":"–£","Z":"–ó","I":"–ò","E":"–≠","ch":"—á","–∑h":"–∂","–∫h":"—Ö'","√ßch":"—â","g'":"“ë",
  "ye":"–µ","yo":"—ë","ya":"—è","yu":"—é","y'":"—ã","√ßh":"—à","a":"–∞","b":"–±","v":"–≤","g":"–≥","d":"–¥","k":"–∫","t":"—Ç",
  "j":"—Ö","f":"—Ñ","l":"–ª","m":"–º","n":"–Ω","o":"–æ","p":"–ø","r":"—Ä","s":"√ß","u":"—É","z":"–∑","i":"–∏","e":"—ç"
};
const transKeys = Object.keys(trans).sort((a,b)=>b.length-a.length);
const acentos = { "–∞":"–∞ÃÅ","—ç":"—çÃÅ","–∏":"–∏ÃÅ","–æ":"–æÃÅ","—É":"—ÉÃÅ","—è":"—èÃÅ","–µ":"–µÃÅ","—é":"—éÃÅ","—ã":"—ãÃÅ" };

/* ================= CARGA DE DATOS ================= */
function loadDictionary() {
    try {
        const rawData = localStorage.getItem("shalkioDict");
        if (rawData) {
            dictionary = JSON.parse(rawData);
        }
        // Asegurar estructura
        alphabet.forEach(l => { if(!Array.isArray(dictionary[l])) dictionary[l]=[]; });
    } catch (e) {
        console.error("Error JSON:", e);
        dictionary = {};
        alphabet.forEach(l => { dictionary[l]=[]; });
    }
}

/* ================= TRANSLITERADOR ================= */
const txt = document.getElementById("txt");
txt.addEventListener("input",()=>{
  let v = txt.value;
  for (const k of transKeys) {
    const safe = k.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    v = v.replace(new RegExp(safe, "g"), trans[k]);
  }
  v = v.replace(/([–∞—ç–∏–æ—É—è–µ—é—ã])</g, (m, l) => acentos[l] || l);
  v = v.replace(/([–ê–≠–ò–û–£–Ø–ï–Æ–´])</g, "$1¬¥");
  txt.value = v;
});

/* ================= DICCIONARIO INTERFAZ ================= */
function createAlphabet() {
    const div = document.getElementById("letters");
    div.innerHTML = "";
    alphabet.forEach(l => {
        const b = document.createElement("button");
        b.textContent = l;
        b.className = (l === current) ? "active-btn" : "";
        b.onclick = () => { current = l; createAlphabet(); render(); };
        div.appendChild(b);
    });
}
// 2. L√≥gica del TAB Especial (CORREGIDA)
txt.addEventListener("keydown", (e) => {
    if (e.key !== "Tab") return;

    e.preventDefault(); // Evita que el cursor salte fuera del textarea
    
    const pos = txt.selectionStart;
    const text = txt.value;

    const char1 = text.slice(pos - 1, pos);
    const char2 = text.slice(pos - 2, pos);

    // Funci√≥n interna para aplicar el reemplazo
    const applyReplace = (offset, newVal) => {
        txt.value = text.slice(0, pos - offset) + newVal + text.slice(pos);
        // Colocamos el cursor justo despu√©s del nuevo car√°cter
        txt.selectionStart = txt.selectionEnd = pos - offset + newVal.length;
    };

    // --- REGLAS DE SUSTITUCI√ìN ---
    if (char2 === "–¢√ß") { applyReplace(2, "–°"); return; }
    if (char2 === "—Ç√ß") { applyReplace(2, "—Å"); return; }
    if (char2 === "''") { applyReplace(2, "—ä"); return; }
    
    if (char1 === "–ì") { applyReplace(1, "“ê"); return; }
    if (char1 === "–≥") { applyReplace(1, "“ë"); return; }
    if (char1 === "'") { applyReplace(1, "—å"); return; }
    if (char1 === "Y") { applyReplace(1, "–ô"); return; }
    if (char1 === "y") { applyReplace(1, "–π"); return; }
});
function render() {
    const list = document.getElementById("list");
    const indicator = document.getElementById("currentLetter");
    let query = document.getElementById("search").value;

    // Buscador Inteligente
    for (const k of transKeys) {
        query = query.replace(new RegExp(k, "g"), trans[k]);
    }
    const q = query.toLowerCase();

    indicator.textContent = "Letra: " + current;
    list.innerHTML = "";

    const entries = dictionary[current] || [];

    entries.forEach(e => {
        const wordMatch = e.word.toLowerCase();
        const meanMatch = e.meaning.toLowerCase();
        
        if (q && !wordMatch.includes(q) && !meanMatch.includes(q)) return;

        const li = document.createElement("li");
        li.className = "entry-card";
        li.innerHTML = `
            <div class="word-row">
                <span class="shalkio-word">${e.word}</span>
                <span class="meaning-text">‚Äî ${e.meaning}</span>
            </div>
            ${e.notes ? `<span class="notes-text">${e.notes}</span>` : ""}
        `;
        list.appendChild(li);
    });
}

/* ================= IMPORTACI√ìN ================= */
document.getElementById("importFile").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
        try {
            const data = JSON.parse(reader.result);
            dictionary = data;
            localStorage.setItem("shalkioDict", JSON.stringify(data));
            render();
            alert("‚úÖ Diccionario cargado.");
        } catch (err) {
            alert("‚ùå Archivo no v√°lido.");
        }
    };
    reader.readAsText(file, "UTF-8");
});

document.getElementById("search").addEventListener("input", render);

// Iniciar todo
loadDictionary();
createAlphabet();
render();
</script>

</body>
</html>